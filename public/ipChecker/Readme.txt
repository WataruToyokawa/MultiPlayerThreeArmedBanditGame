#########################################################################
#　　　　　     製品名：IP-Checker for PHP（Free,PHP)	      		#
#		                バージョン：2.9				#
#		 	　　　    製作者：天星	 　  			#
#			 再配布：無許可(許可必要)			#
#		 	　   完成日：07/02/10		   　		#
#			    最終更新日：12/12/20　　 			#　
#########################################################################

はじめに：
　この度は、IP-Checker for PHPをダウンロードいただき、まことに有難うございます。　
　IP-Checker for PHPは、IP-CheckerのCGI版と同じで
　IPチェック、PROXYチェック、時間外チェック、日・曜日チェック
　管理者設定の利用禁止IP,HOSTチェック、リンク元アドレスチェックを行い、
　不正を検知したら規制を行う物です。
  他のPHPと連動する様になりました。

動作について：
　今の所、当ホームページのサーバでは検知確認済みですが
　サーバによっては上手く動作しない事もあります。ご了承願います。
  
  2.0より前バージョンの時の様には確認ページが出ません。
  その為、設定完了後、アクセス禁止時間帯などを現在時刻にかかる様に設定して
  エラーページが表示される事の確認をして下さい。

使用方法：

設定後、ipc.phpをアップロードしてください。
Torチェックを行う場合は、tor_data.phpもアップロードしてください。

設置後、エラーが出る場合は、設定項目が"*";で囲まれているか確認してください。
(*は設定内容です。)
  ・IP-Checkerと連動させるPHPを開いてください。
  ・上から2行目にrequire("ipc.php");を追加、保存してください。
  
　・次にipc.phpをテキストエディタ等で開いて設定を行ってください。

　・$titleはタイトルを入力してください。

　・$ps_blockはパスワード制限です。 0=OFF 1=常にON 2=規制対象者のみON
    2の場合、PROXY規制などの規制対象者がパスワードを入力することにより入場できます。

　・$bpsはパスワード制限用の認証パス　複数設定可能で""で囲み,で区切ってください。

　・$noacstsはアクセス禁止時間帯を利用するかしないかです。
　　0の場合使用しない。1の場合使用する。

  ・$noacsはアクセス禁止日時です。
	 "日付 か 曜日/[アクセス禁止開始時間]-[アクセス禁止終了時間]";のように設定。
	日付か曜日の部分をAllにすると毎日の設定になります。設定例:"All/15-16";
	また、""内で,で区切る事により複数設定できます。設定例:"日/15-16,月/16-17,5/17-18";

　・$refはリファラが代入されてない場合にアクセスを禁止します。
    0の場合は使用しない。1の場合は使用する。
	
　・$noacsrは特定のリンク元のアドレスからしか来させない様にする場合に
　　アドレス設定してください。http://は不要で/を入力する場合は変わりに*を利用してください。
	複数設定可能です。''で囲み、,で区切って下さい。　正規表現で指定してください。

  ・$xipcfはアクセスの禁止方式を設定して下さい。
    0の場合は、指定したIPからのアクセスを許可します。
	1の場合は、指定したIPからのアクセスを禁止します。
　・$denyはIPアクセス規制で禁止or許可するIP,HOSTを設定してください。
　　また、あるプロバイダ使用者を全部禁止する場合は、固定部分を入力してください。

　・$refuseproxyはPROXY経由でのアクセスを禁止する場合は1、禁止しない場合は
　　0を入力してください。

  ・$kipsはPROXYを付けてない方がチェックにかかった場合にアドレスを指定してください。　正規表現で指定してください。
　　指定する事により通過できるようにします。
　　注意：固定部分を指定するとそのプロバイダ使用者全員が通過できてしまうのでお気をつけください。　　　　　　　　　　　　　　　　　　

　・$tor_swは、PROXYの一種であるTorを規制します。(1=ON , 0 =OFF)
  ・$tor_ip_list[0] TorのIPリストの取得先です。
	1行毎にIPが記述されているサイトが対応できます。	
　・$tor_save_name[0]　取得したIPリストの保存場所
  ・$up_time_set IPリストを再取得する時間です。
  　サーバに保存したデータの最終更新時間から計算します。
	指定した時間（分）を経過している場合、取得先へアクセスして取得します。

  ・$quckクエリ内の文字をチェックします。 1=ON,0=OFF
  ・$wordチェックする禁止文字を指定してください。
  
  ・$ck_reg 特定クエリの送信を規制します。　0=OFF , 1=指定時間を経過しないと次の送信できない , 2 =設定1 + 指定回数を超えてのクエリを受け付けない。
  ・$ck_tlim 1回投稿後にここに指定した時間を経過しないと次の送信は出来ません。(分)
  ・$ck_cnt 特定のクエリを受け付ける最大回数(1日)

  ・$ck_qname チェックするクエリのname値 
　・$ck_qval チェックするクエリのvalu値
  
  		掲示板などの投稿フォーム部分にモード判別用の記述があると思います。
		それを参照し、指定してください。
		<input type="hidden" name="mode" value="new">の場合、nameは「mode」valueは「new」　($ck_qname = "mode"; $ck_qval = "new";)
  
お問い合わせ：
　・ご意見、ご感想、質問、エラー報告等は、メールまたは、雑談板で！！
　  メールはホームページのお問い合わせページからお願いします。
　・HPは「天空の彼方」http://www.tenskystar.net/
　　
注意事項:
 ・許可無しにPHPの配布をする事を禁止しています。
 ・また、勝手に著作権表示を消去しないでください。
 ・IP-Cehcekrを使用しての損害、損失などの責任は一切取りませんので
　 必ず自己責任で御使用下さい。

更新情報
・12/12/20 Ver:2.9
Torチェック

・12/05/19 Ver:2.8
セキュリティ上の調整

・12/03/23 Ver:2.7
指定クエリをチェックして投稿-回数,間隔の規制を行えるように。

・11/06/30 Ver:2.6
規制対象者のみのパスワード認証による通過も出来るように。

・11/01/11 Ver:2.5
パスワード制限を行えるように。（IPCと連動させるだけで、パスワード制限をつけられる。)

・10/11/01 Ver:2.4
アクセス拒否URLを複数設定可能に。

・10/10/17 Ver:2.3
指定IPアクセス禁止を指定IPのみアクセス許可方式にもできる様に。

・10/04/05 Ver:2.2
連携物がCookie利用する場合にエラーが発生するのを修正。
クエリ内に含まれる文字チェックを追加。

・09/10/09 Ver:2.1
強制許可、強制制限をIP,HOSTどちらでも指定可能に修正。

・09/03/05 Ver:2.0
他のPHPと連動して規制を行う方式に変更。
よって、IP-Checkerが表示するのは規制対象時のみ。

・08/03/31 Ver:1.4
日時によってのアクセス禁止方法を変更。
各日・曜日の時間を設定し規制を行う様に。

・08/03/30 Ver:1.3

提案によりアクセス禁止する日・曜日の設定を追加。
またリファラー情報が無い場合(Ip-checkerに直接アクセスした時)に規制。
IPが取得出来なかった場合も規制。←多分殆ど無いけど。

・08/02/03 Ver:1.2
強制許可を('',)と言う風にしておくと
PROXY規制をONにしても全員許可されてしまうのを修正。

・07/02/18 Ver:1.1

CGIで言うパターンマッチ？のやり方が分かったので
指定URL以外からのアクセス、指定IP,HOSTの規制などを追加。
これでほとんどCGIと同じに。配布開始。

・07/02/10 Ver:1.0

CGI版を基本として製作。
PHP初心者なのでパターンマッチの方法や色々と分からなかったので
とにかくPROXY規制のみの機能だけ製作。